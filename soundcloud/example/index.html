<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <script type="text/javascript" src="../d3.v2.js"></script>
  </head>
<body>
  <div id="loaded"></div>
  <script type="text/javascript" charset="utf-8" src="http://code.jquery.com/jquery.min.js"></script>
  <script src="http://connect.soundcloud.com/sdk.js"></script>
  <script>
var r = 960,
    format = d3.format(",d"),
    fill = d3.scale.category20c();
 
var bubble = d3.layout.pack()
     .sort(null)
     .size([r, r]);
 
var vis = d3.select("#chart").append("svg")
    .attr("width", r)
    .attr("height", r)
    .attr("class", "bubble");
 
    SC.initialize({
      client_id: "7kIeyF5f2ETFo1fEWKwNQ",
      redirect_uri: "http://localhost:8000/soundcloud/example/",
    });
    
    SC.get("/tracks?genres=dubstep&order=hotness", {limit: 100}, function(tracks){
      console.log(tracks);
      $(tracks).each(function(track) {
          var node = vis.selectAll("g.node") // make element g, gives it class "node"
              .data(bubble.nodes(classes(json)) // gets data and applies "bubble" to node data - using data, apply bubble
              .filter(function(d) { return !d.children; })) // then filters? and returns children
          .enter().append("g") // appends information from "g", wtf is "g" - I dunno
              .attr("class", "node") // applies class: node -
              .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; }); // applies bubble transform: function(d)
          });
    });
  </script>

    <script type="text/javascript" charset="utf-8">
     var r = 960,
     format = d3.format(",d"),
     fill = d3.scale.category20c();
 
 var bubble = d3.layout.pack()
     .sort(null)
     .size([r, r]);
 
 var vis = d3.select("#chart").append("svg")
    .attr("width", r)
    .attr("height", r)
    .attr("class", "bubble");

d3.json("../flare.json", function(json) {
  var node = vis.selectAll("g.node")
      .data(bubble.nodes(classes(json))
      .filter(function(d) { return !d.children; }))
    .enter().append("g")
      .attr("class", "node")
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

  node.append("title")
      .text(function(d) { return d.className + ": " + format(d.value); });

  node.append("circle")
      .attr("r", function(d) { return d.r; })
      .style("fill", function(d) { return fill(d.packageName); });

  node.append("text")
      .attr("text-anchor", "middle")
      .attr("dy", ".3em")
      .text(function(d) { return d.className.substring(0, d.r / 3); });
});

// Returns a flattened hierarchy containing all leaf nodes under the root.
function classes(root) {
  var classes = [];

  function recurse(name, node) {
    if (node.children) node.children.forEach(function(child) { recurse(node.name, child); });
    else classes.push({packageName: name, className: node.name, value: node.size});
  }

  recurse(null, root);
  return {children: classes};
}
    </script>

<div class='gallery' id='chart'> </div><link href='../bubble.css' rel='stylesheet' type='text/css' /><script src='../bubble.js' type='text/javascript'> </script>
  </body>
</html>
